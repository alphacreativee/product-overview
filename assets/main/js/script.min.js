import*as THREE from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";import*as dat from"https://cdn.skypack.dev/dat.gui";document.addEventListener("DOMContentLoaded",o=>{gsap.registerPlugin(ScrollTrigger,SplitText);let t=new Lenis;t.on("scroll",ScrollTrigger.update),gsap.ticker.add(o=>{t.raf(1e3*o)}),gsap.ticker.lagSmoothing(0);var e=new SplitText(".header-1 h1",{type:"chars",charsClass:"char"}),n=new SplitText(".tooltip .title h2",{type:"lines",linesClass:"line"}),i=new SplitText(".tooltip .description p",{type:"lines",linesClass:"line"});e.chars.forEach(o=>o.innerHTML=`<span>${o.innerHTML}</span>`),[...n.lines,...i.lines].forEach(o=>o.innerHTML=`<span>${o.innerHTML}</span>`);let a={duration:1,ease:"power3.out",stagger:.025},s=[{trigger:.65,elements:[".tooltip:nth-child(1) .icon h3",".tooltip:nth-child(1) .title .line > span",".tooltip:nth-child(1) .description .line > span"]},{trigger:.85,elements:[".tooltip:nth-child(2) .icon h3",".tooltip:nth-child(2) .title .line > span",".tooltip:nth-child(2) .description .line > span"]}];ScrollTrigger.create({trigger:".product-overview",start:"75% bottom",onEnter:()=>{gsap.to(".header-1 h1 .char > span",{y:"0%",duration:1,ease:"power3.out",stagger:.025})},onLeaveBack:()=>{gsap.to(".header-1 h1 .char > span",{y:"100%",duration:1,ease:"power3.out",stagger:.025})}});let d,r=0,l,h=!1,g=!1,p=new THREE.Scene,m=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),c=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),E=(c.setClearColor(0,0),c.setSize(window.innerWidth,window.innerHeight),c.setPixelRatio(Math.min(window.devicePixelRatio,2)),c.shadowMap.enabled=!0,c.shadowMap.type=THREE.PCFSoftShadowMap,c.outputEncoding=THREE.LinearEncoding,c.toneMapping=THREE.NoToneMapping,c.toneMappingExposure=1,document.querySelector(".modal-container").appendChild(c.domElement),p.add(new THREE.AmbientLight(16777215,.7)),new THREE.DirectionalLight(16777215,1)),R=(E.position.set(2,2,3),E.castShadow=!0,E.shadow.bias=-.001,E.shadow.mapSize.width=1024,E.shadow.mapSize.height=1024,p.add(E),new THREE.DirectionalLight(16777215,.5)),w=(R.position.set(-2,0,-2),p.add(R),new dat.GUI),P={ambientIntensity:.7,mainLightIntensity:1,mainLightColor:"#ffffff",mainLightPosX:2,mainLightPosY:2,mainLightPosZ:3,fillLightIntensity:.5,fillLightColor:"#ffffff",fillLightPosX:-2,fillLightPosY:0,fillLightPosZ:-2,modalPosX:0,modalPosY:0,modalPosZ:0,modalRotX:0,modalRotY:0,modalRotZ:0,resetRotation:()=>{var o;d&&(o=window.innerWidth<1024,d.rotation.set(THREE.MathUtils.degToRad(-25),THREE.MathUtils.degToRad(-40),o?0:THREE.MathUtils.degToRad(-25)),P.modalRotX=d.rotation.x,P.modalRotY=d.rotation.y,P.modalRotZ=d.rotation.z,w.__folders["Modal Rotation (Xoay mô hình)"].__controllers.forEach(o=>{o.updateDisplay()}),g=!1,console.log("Rotation reset to initial values"))}};w.addFolder("Ambient Light (ánh sáng môi trường)").add(P,"ambientIntensity",0,2,.1).name("Intensity").onChange(o=>{p.children.find(o=>o instanceof THREE.AmbientLight).intensity=o});e=w.addFolder("Main Directional Light (hướng chính)"),e.add(P,"mainLightIntensity",0,2,.1).name("Intensity").onChange(o=>{E.intensity=o}),e.addColor(P,"mainLightColor").name("Color").onChange(o=>{E.color.set(o)}),e.add(P,"mainLightPosX",-20,20,.1).name("Position X").onChange(o=>{E.position.x=o}),e.add(P,"mainLightPosY",-10,10,.1).name("Position Y").onChange(o=>{E.position.y=o}),e.add(P,"mainLightPosZ",-10,10,.1).name("Position Z").onChange(o=>{E.position.z=o}),n=w.addFolder("Fill Directional Light (hướng phụ)"),n.add(P,"fillLightIntensity",0,2,.1).name("Intensity").onChange(o=>{R.intensity=o}),n.addColor(P,"fillLightColor").name("Color").onChange(o=>{R.color.set(o)}),n.add(P,"fillLightPosX",-10,10,.1).name("Position X").onChange(o=>{R.position.x=o}),n.add(P,"fillLightPosY",-10,10,.1).name("Position Y").onChange(o=>{R.position.y=o}),n.add(P,"fillLightPosZ",-10,10,.1).name("Position Z").onChange(o=>{R.position.z=o}),i=w.addFolder("Modal Position (Vị trí mô hình)"),i.add(P,"modalPosX",-10,10,.1).name("Position X").onChange(o=>{d&&(d.position.x=o,h=!0)}),i.add(P,"modalPosY",-10,10,.1).name("Position Y").onChange(o=>{d&&(d.position.y=o,h=!0)}),i.add(P,"modalPosZ",-10,10,.1).name("Position Z").onChange(o=>{d&&(d.position.z=o,h=!0)}),e=w.addFolder("Modal Rotation (Xoay mô hình)");function T(){var o;d&&(o=(new THREE.Box3).setFromObject(d).getCenter(new THREE.Vector3),console.log("Rotation (radians):",d.rotation),console.log("Center Position:",o),console.log("Camera Position:",m.position))}e.add(P,"modalRotX",2*-Math.PI,2*Math.PI,.01).name("Rotation X").onChange(o=>{d&&(d.rotation.x=o,g=!0,T())}),e.add(P,"modalRotY",2*-Math.PI,2*Math.PI,.01).name("Rotation Y").onChange(o=>{d&&(d.rotation.y=o,g=!0,r=o,T())}),e.add(P,"modalRotZ",2*-Math.PI,2*Math.PI,.01).name("Rotation Z").onChange(o=>{d&&(d.rotation.z=o,g=!0,T())}),e.add(P,"resetRotation").name("Reset Rotation");let f;function L(){var o;!d||!l||h&&g||(f=window.innerWidth<1024,o=(new THREE.Box3).setFromObject(d).getCenter(new THREE.Vector3),h||d.position.set(f?o.x+ +l.x:-o.x-.4*l.x,-o.y+.085*l.y,-o.z),g||(d.rotation.set(THREE.MathUtils.degToRad(-5),THREE.MathUtils.degToRad(0),f?0:THREE.MathUtils.degToRad(-25)),r=0),o=f?2:1.2,m.position.set(0,0,Math.max(l.x,l.y,l.z)*o),m.lookAt(0,0,0),P.modalPosX=d.position.x,P.modalPosY=d.position.y,P.modalPosZ=d.position.z,P.modalRotX=d.rotation.x,P.modalRotY=d.rotation.y,P.modalRotZ=d.rotation.z,w.__folders["Modal Position (Vị trí mô hình)"]&&w.__folders["Modal Position (Vị trí mô hình)"].__controllers.forEach(o=>{o.updateDisplay()}),w.__folders["Modal Rotation (Xoay mô hình)"]&&w.__folders["Modal Rotation (Xoay mô hình)"].__controllers.forEach(o=>{o.updateDisplay()}))}(new GLTFLoader).load("./assets/images/vacuum.glb",o=>{(d=o.scene).traverse(o=>{o.isMesh&&o.material&&Object.assign(o.material,{metalness:.05,roughness:.9})});o=(new THREE.Box3).setFromObject(d).getSize(new THREE.Vector3);l=o,p.add(d),L()}),function o(){requestAnimationFrame(o),c.render(p,m)}(),window.addEventListener("resize",()=>{m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight),L()}),ScrollTrigger.create({trigger:".product-overview",start:"top top",end:`+=${5*window.innerHeight}px`,pin:!0,pinSpacing:!0,scrub:1,onUpdate:({progress:e})=>{var o,t=Math.max(0,Math.min(1,(e-.05)/.3)),t=(gsap.to(".header-1 ",{xPercent:e<.05?0:.35<e?-100:-100*t}),e<.2?0:.3<e?100:(e-.2)/.1*100),t=(gsap.to(".circular-mask",{clipPath:`circle(${t}%  at 50% 50%)`}),(e-.15)/.35),t=(gsap.to(".header-2",{xPercent:e<.15?100:.5<e?-200:100-300*t}),e<.45?0:.65<e?100:(e-.45)/.2*100);gsap.to(".tooltips .divider",{scaleX:t+"%",...a}),s.forEach(({trigger:o,elements:t})=>{gsap.to(t,{y:o<=e?"0%":"125%",...a})}),d&&.05<e&&!g&&(o=(t=3*Math.PI*4*((e-.05)/.95))-r,.001<Math.abs(o))&&(d.rotateOnAxis(new THREE.Vector3(0,1,0),o),r=t,P.modalRotY=d.rotation.y,w.__folders["Modal Rotation (Xoay mô hình)"].__controllers[1].updateDisplay(),T())}})});
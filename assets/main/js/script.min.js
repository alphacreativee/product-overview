import*as THREE from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";import*as dat from"https://cdn.skypack.dev/dat.gui";document.addEventListener("DOMContentLoaded",o=>{gsap.registerPlugin(ScrollTrigger,SplitText);let t=new Lenis;t.on("scroll",ScrollTrigger.update),gsap.ticker.add(o=>{t.raf(1e3*o)}),gsap.ticker.lagSmoothing(0);var e=new SplitText(".header-1 h1",{type:"chars",charsClass:"char"}),n=new SplitText(".tooltip .title h2",{type:"lines",linesClass:"line"}),i=new SplitText(".tooltip .description p",{type:"lines",linesClass:"line"});e.chars.forEach(o=>o.innerHTML=`<span>${o.innerHTML}</span>`),[...n.lines,...i.lines].forEach(o=>o.innerHTML=`<span>${o.innerHTML}</span>`);let a={duration:1,ease:"power3.out",stagger:.025},s=[{trigger:.65,elements:[".tooltip:nth-child(1) .icon h3",".tooltip:nth-child(1) .title .line > span",".tooltip:nth-child(1) .description .line > span"]},{trigger:.85,elements:[".tooltip:nth-child(2) .icon h3",".tooltip:nth-child(2) .title .line > span",".tooltip:nth-child(2) .description .line > span"]}];ScrollTrigger.create({trigger:".product-overview",start:"75% bottom",onEnter:()=>{gsap.to(".header-1 h1 .char > span",{y:"0%",duration:1,ease:"power3.out",stagger:.025})},onLeaveBack:()=>{gsap.to(".header-1 h1 .char > span",{y:"100%",duration:1,ease:"power3.out",stagger:.025})}});let r,d=0,l,h=!1,g=!1,p=new THREE.Scene,m=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.1,1e3),c=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),w=(c.setClearColor(0,0),c.setSize(window.innerWidth,window.innerHeight),c.setPixelRatio(Math.min(window.devicePixelRatio,2)),c.shadowMap.enabled=!0,c.shadowMap.type=THREE.PCFSoftShadowMap,c.outputEncoding=THREE.LinearEncoding,c.toneMapping=THREE.NoToneMapping,c.toneMappingExposure=1,document.querySelector(".modal-container").appendChild(c.domElement),p.add(new THREE.AmbientLight(16777215,.7)),new THREE.DirectionalLight(16777215,1)),E=(w.position.set(2,2,3),w.castShadow=!0,w.shadow.bias=-.001,w.shadow.mapSize.width=1024,w.shadow.mapSize.height=1024,p.add(w),new THREE.DirectionalLight(16777215,.5)),R=(E.position.set(-2,0,-2),p.add(E),new dat.GUI),P={ambientIntensity:.7,mainLightIntensity:1,mainLightColor:"#ffffff",mainLightPosX:2,mainLightPosY:2,mainLightPosZ:3,fillLightIntensity:.5,fillLightColor:"#ffffff",fillLightPosX:-2,fillLightPosY:0,fillLightPosZ:-2,modalPosX:0,modalPosY:0,modalPosZ:0,modalRotX:0,modalRotY:0,modalRotZ:0,resetRotation:()=>{var o;r&&(o=window.innerWidth<1024,r.rotation.set(0,0,o?0:THREE.MathUtils.degToRad(-25)),P.modalRotX=r.rotation.x,P.modalRotY=r.rotation.y,P.modalRotZ=r.rotation.z,R.__folders["Modal Rotation (Xoay mô hình)"].__controllers.forEach(o=>{o.updateDisplay()}),g=!1,console.log("Rotation reset to initial values"))}};R.addFolder("Ambient Light (ánh sáng môi trường)").add(P,"ambientIntensity",0,2,.1).name("Intensity").onChange(o=>{p.children.find(o=>o instanceof THREE.AmbientLight).intensity=o});e=R.addFolder("Main Directional Light (hướng chính)"),e.add(P,"mainLightIntensity",0,2,.1).name("Intensity").onChange(o=>{w.intensity=o}),e.addColor(P,"mainLightColor").name("Color").onChange(o=>{w.color.set(o)}),e.add(P,"mainLightPosX",-20,20,.1).name("Position X").onChange(o=>{w.position.x=o}),e.add(P,"mainLightPosY",-10,10,.1).name("Position Y").onChange(o=>{w.position.y=o}),e.add(P,"mainLightPosZ",-10,10,.1).name("Position Z").onChange(o=>{w.position.z=o}),n=R.addFolder("Fill Directional Light (hướng phụ)"),n.add(P,"fillLightIntensity",0,2,.1).name("Intensity").onChange(o=>{E.intensity=o}),n.addColor(P,"fillLightColor").name("Color").onChange(o=>{E.color.set(o)}),n.add(P,"fillLightPosX",-10,10,.1).name("Position X").onChange(o=>{E.position.x=o}),n.add(P,"fillLightPosY",-10,10,.1).name("Position Y").onChange(o=>{E.position.y=o}),n.add(P,"fillLightPosZ",-10,10,.1).name("Position Z").onChange(o=>{E.position.z=o}),i=R.addFolder("Modal Position (Vị trí mô hình)"),i.add(P,"modalPosX",-10,10,.1).name("Position X").onChange(o=>{r&&(r.position.x=o,h=!0)}),i.add(P,"modalPosY",-10,10,.1).name("Position Y").onChange(o=>{r&&(r.position.y=o,h=!0)}),i.add(P,"modalPosZ",-10,10,.1).name("Position Z").onChange(o=>{r&&(r.position.z=o,h=!0)}),e=R.addFolder("Modal Rotation (Xoay mô hình)");function f(){var o;r&&(o=(new THREE.Box3).setFromObject(r).getCenter(new THREE.Vector3),console.log("Rotation (radians):",r.rotation),console.log("Center Position:",o),console.log("Camera Position:",m.position))}e.add(P,"modalRotX",2*-Math.PI,2*Math.PI,.01).name("Rotation X").onChange(o=>{r&&(r.rotation.x=o,g=!0,f())}),e.add(P,"modalRotY",2*-Math.PI,2*Math.PI,.01).name("Rotation Y").onChange(o=>{r&&(r.rotation.y=o,g=!0,d=o,f())}),e.add(P,"modalRotZ",2*-Math.PI,2*Math.PI,.01).name("Rotation Z").onChange(o=>{r&&(r.rotation.z=o,g=!0,f())}),e.add(P,"resetRotation").name("Reset Rotation");let L;function y(){var o;!r||!l||h&&g||(L=window.innerWidth<1024,o=(new THREE.Box3).setFromObject(r).getCenter(new THREE.Vector3),h||r.position.set(L?o.x+ +l.x:-o.x-.4*l.x,-o.y+.085*l.y,-o.z),g||(r.rotation.set(0,0,L?0:THREE.MathUtils.degToRad(-25)),d=0),o=L?2:1.25,m.position.set(0,0,Math.max(l.x,l.y,l.z)*o),m.lookAt(0,0,0),P.modalPosX=r.position.x,P.modalPosY=r.position.y,P.modalPosZ=r.position.z,P.modalRotX=r.rotation.x,P.modalRotY=r.rotation.y,P.modalRotZ=r.rotation.z,R.__folders["Modal Position (Vị trí mô hình)"]&&R.__folders["Modal Position (Vị trí mô hình)"].__controllers.forEach(o=>{o.updateDisplay()}),R.__folders["Modal Rotation (Xoay mô hình)"]&&R.__folders["Modal Rotation (Xoay mô hình)"].__controllers.forEach(o=>{o.updateDisplay()}))}(new GLTFLoader).load("./assets/images/modal.glb",o=>{(r=o.scene).traverse(o=>{o.isMesh&&o.material&&Object.assign(o.material,{metalness:.05,roughness:.9})});o=(new THREE.Box3).setFromObject(r).getSize(new THREE.Vector3);l=o,p.add(r),y()}),function o(){requestAnimationFrame(o),c.render(p,m)}(),window.addEventListener("resize",()=>{m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight),y()}),ScrollTrigger.create({trigger:".product-overview",start:"top top",end:`+=${10*window.innerHeight}px`,pin:!0,pinSpacing:!0,scrub:1,markers:!0,onUpdate:({progress:e})=>{var o,t=Math.max(0,Math.min(1,(e-.05)/.3)),t=(gsap.to(".header-1 ",{xPercent:e<.05?0:.35<e?-100:-100*t}),e<.2?0:.3<e?100:(e-.2)/.1*100),t=(gsap.to(".circular-mask",{clipPath:`circle(${t}%  at 50% 50%)`}),(e-.15)/.35),t=(gsap.to(".header-2",{xPercent:e<.15?100:.5<e?-200:100-300*t}),e<.45?0:.65<e?100:(e-.45)/.2*100);gsap.to(".tooltips .divider",{scaleX:t+"%",...a}),s.forEach(({trigger:o,elements:t})=>{gsap.to(t,{y:o<=e?"0%":"125%",...a})}),r&&.05<e&&!g&&(o=(t=3*Math.PI*4*((e-.05)/.95))-d,.001<Math.abs(o))&&(r.rotateOnAxis(new THREE.Vector3(0,1,0),o),d=t,P.modalRotY=r.rotation.y,R.__folders["Modal Rotation (Xoay mô hình)"].__controllers[1].updateDisplay(),f())}})});